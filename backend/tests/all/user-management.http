### User Management API Tests
### Server: http://localhost:3001

# ===========================================
# SETUP - Get Admin Token First
# ===========================================

### 1. Request OTP for Admin
POST http://localhost:3001/api/auth/request-otp
Content-Type: application/json

{
  "identifier": "admin@institute.com",
  "method": "email"
}

### 2. Verify OTP and Get Token (replace OTP_CODE)
POST http://localhost:3001/api/auth/verify-otp
Content-Type: application/json

{
  "identifier": "admin@institute.com",
  "code": "440218"
}

### Save token from response as @adminToken

# ===========================================
# GET ALL USERS
# ===========================================
@adminToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI0NjJjY2QzOS0xMzU5LTQ2MTYtODFjMi0zYzMxYTgxZDhjZTMiLCJlbWFpbCI6ImFkbWluQGluc3RpdHV0ZS5jb20iLCJyb2xlIjoiQURNSU4iLCJpYXQiOjE3NjM0NzUxNTYsImV4cCI6MTc2NDA3OTk1Nn0.KPVCuUKRLFvHFfQYOodrfIxbvcEDPDzntypcockzTl4
### Get all users (Admin only)
GET http://localhost:3001/api/users
Authorization: Bearer {{adminToken}}

### Filter by role
GET http://localhost:3001/api/users?role=STUDENT
Authorization: Bearer {{adminToken}}

### Filter by active status
GET http://localhost:3001/api/users?isActive=true
Authorization: Bearer {{adminToken}}

### Search by email
GET http://localhost:3001/api/users?search=ahmed
Authorization: Bearer {{adminToken}}

### Pagination
GET http://localhost:3001/api/users?page=1&limit=2
Authorization: Bearer {{adminToken}}

### Combined filters
GET http://localhost:3001/api/users?role=STUDENT&isActive=true&page=1&limit=10
Authorization: Bearer {{adminToken}}

### ERROR - No token (401)
GET http://localhost:3001/api/users

### ERROR - Invalid token (401)
GET http://localhost:3001/api/users
Authorization: Bearer invalid-token-12345

# ===========================================
# GET USER BY ID
# ===========================================
@userId = 5682419f-939a-4ecc-a50b-dced7ad83a87
### Get specific user (replace USER_ID)
GET http://localhost:3001/api/users/{{userId}}
Authorization: Bearer {{adminToken}}

### ERROR - User not found (404)
GET http://localhost:3001/api/users/00000000-0000-0000-0000-000000000000
Authorization: Bearer {{adminToken}}

# ===========================================
# UPDATE USER
# ===========================================

### Update email
PUT http://localhost:3001/api/users/{{userId}}
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "email": "ahmed.updated@example.com"
}

### Update phone
PUT http://localhost:3001/api/users/{{userId}}
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "phone": "33999889"
}

### Update active status
PUT http://localhost:3001/api/users/{{userId}}
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "isActive": true
}

### Update multiple fields
PUT http://localhost:3001/api/users/{{userId}}
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "email": "new.email@example.com",
  "phone": "33777666",
  "isActive": true
}

### ERROR - Duplicate email (400)
PUT http://localhost:3001/api/users/{{userId}}
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "email": "admin@institute.com"
}

# ===========================================
# DELETE USER (Deactivate)
# ===========================================

### Deactivate user
DELETE http://localhost:3001/api/users/{{userId}}
Authorization: Bearer {{adminToken}}

### ERROR - User not found (404)
DELETE http://localhost:3001/api/users/00000000-0000-0000-0000-000000000000
Authorization: Bearer {{adminToken}}

# ===========================================
# CHANGE USER ROLE
# ===========================================

### Change role to TEACHER
PATCH http://localhost:3001/api/users/{{userId}}/role
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "role": "TEACHER"
}

### Change role to PARENT
PATCH http://localhost:3001/api/users/{{userId}}/role
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "role": "PARENT"
}

### Change role to ADMIN
PATCH http://localhost:3001/api/users/{{userId}}/role
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "role": "ADMIN"
}

### ERROR - Invalid role (400)
PATCH http://localhost:3001/api/users/{{userId}}/role
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "role": "SUPERUSER"
}

### ERROR - Missing role field (400)
PATCH http://localhost:3001/api/users/{{userId}}/role
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{}
