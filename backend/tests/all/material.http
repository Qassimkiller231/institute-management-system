### ============================================
### MATERIAL MODULE - API TESTS
### ============================================

### Variables (Update these with actual IDs)
@baseUrl = http://localhost:3001/api
@teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI0YzYxNDhiNy05NTJhLTQ1ZWItYjA1NS0zMWQ5MjVlNDRkNjUiLCJlbWFpbCI6InNhcmFoLnRlYWNoZXJAaW5zdGl0dXRlLmNvbSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzYzMzkwODEzLCJleHAiOjE3NjM5OTU2MTN9.54muh3VK-Bf-3TUYbe7LIyOwqBQ4b-RUQCTLJ-GuPrc
@adminToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI0NjJjY2QzOS0xMzU5LTQ2MTYtODFjMi0zYzMxYTgxZDhjZTMiLCJlbWFpbCI6ImFkbWluQGluc3RpdHV0ZS5jb20iLCJyb2xlIjoiQURNSU4iLCJpYXQiOjE3NjMzNDU0ODcsImV4cCI6MTc2Mzk1MDI4N30._imZsnAjh6mOtksjPVFtlqCNJU3Gmec-suBv_6kc1Xk

@groupId = ce7ad635-c179-46b4-beb0-8cf5fa0404f7
@teacherId = fd435948-d4a9-44ac-8f4e-e8c9887f696d
@materialId = ff64b848-e9ee-49f4-b117-d0707959cf8e

### ============================================
### 1. CREATE MATERIAL
### ============================================

### Create PDF material (Teacher)
POST {{baseUrl}}/materials
Authorization: Bearer {{teacherToken}}
Content-Type: application/json

{
  "groupId": "{{groupId}}",
  "title": "Unit 1 - Grammar Rules",
  "description": "Complete guide to present simple tense",
  "materialType": "PDF",
  "fileUrl": "https://example.com/files/unit1-grammar.pdf",
  "fileSizeKb": 2048
}

### Create video material (Teacher)
POST {{baseUrl}}/materials
Authorization: Bearer {{teacherToken}}
Content-Type: application/json

{
  "groupId": "{{groupId}}",
  "title": "Listening Exercise - Conversation at Restaurant",
  "description": "Practice dialogue for beginner level",
  "materialType": "VIDEO",
  "fileUrl": "https://youtube.com/watch?v=example",
  "fileSizeKb": 15360
}

### Create link material (Teacher)
POST {{baseUrl}}/materials
Authorization: Bearer {{teacherToken}}
Content-Type: application/json

{
  "groupId": "{{groupId}}",
  "title": "Online Quiz - Vocabulary",
  "description": "Interactive quiz on Quizlet",
  "materialType": "LINK",
  "fileUrl": "https://quizlet.com/example"
}

### Create image material (Teacher)
POST {{baseUrl}}/materials
Authorization: Bearer {{teacherToken}}
Content-Type: application/json

{
  "groupId": "{{groupId}}",
  "title": "Flashcards - Common Verbs",
  "materialType": "IMAGE",
  "fileUrl": "https://example.com/flashcards.png",
  "fileSizeKb": 512
}

### Create material as Admin
POST {{baseUrl}}/materials
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "groupId": "{{groupId}}",
  "title": "Course Syllabus",
  "description": "Complete syllabus for A1 level",
  "materialType": "PDF",
  "fileUrl": "https://example.com/syllabus.pdf",
  "fileSizeKb": 1024,
  "teacherId": "{{teacherId}}"
}

### ============================================
### 2. GET ALL MATERIALS
### ============================================

### Get all materials (paginated)
GET {{baseUrl}}/materials
Authorization: Bearer {{teacherToken}}

### Get materials with filters
GET {{baseUrl}}/materials?materialType=PDF&isActive=true
Authorization: Bearer {{teacherToken}}

### Get materials for specific group
GET {{baseUrl}}/materials?groupId={{groupId}}
Authorization: Bearer {{teacherToken}}

### Get materials uploaded by specific teacher
GET {{baseUrl}}/materials?uploadedBy={{teacherId}}
Authorization: Bearer {{adminToken}}

### Get materials with pagination
GET {{baseUrl}}/materials?page=1&limit=10
Authorization: Bearer {{teacherToken}}

### ============================================
### 3. GET MATERIALS FOR A GROUP
### ============================================

### Get all materials for a group
GET {{baseUrl}}/materials/group/{{groupId}}
Authorization: Bearer {{teacherToken}}

### Get PDF materials for a group
GET {{baseUrl}}/materials/group/{{groupId}}?materialType=PDF
Authorization: Bearer {{teacherToken}}

### Get active materials only for a group
GET {{baseUrl}}/materials/group/{{groupId}}?isActive=true
Authorization: Bearer {{teacherToken}}

### ============================================
### 4. GET MATERIAL BY ID
### ============================================

### Get material details
GET {{baseUrl}}/materials/{{materialId}}
Authorization: Bearer {{teacherToken}}

### ============================================
### 5. GET MATERIALS BY TYPE
### ============================================

### Get all PDF materials
GET {{baseUrl}}/materials/type/PDF
Authorization: Bearer {{teacherToken}}

### Get all video materials
GET {{baseUrl}}/materials/type/VIDEO
Authorization: Bearer {{teacherToken}}

### Get all link materials
GET {{baseUrl}}/materials/type/LINK
Authorization: Bearer {{teacherToken}}

### Get all image materials
GET {{baseUrl}}/materials/type/IMAGE
Authorization: Bearer {{teacherToken}}

### ============================================
### 6. GET TEACHER MATERIALS
### ============================================

### Get all materials uploaded by a teacher
GET {{baseUrl}}/materials/teacher/{{teacherId}}
Authorization: Bearer {{teacherToken}}

### ============================================
### 7. GET GROUP STATISTICS
### ============================================

### Get material statistics for a group
GET {{baseUrl}}/materials/group/{{groupId}}/stats
Authorization: Bearer {{teacherToken}}

### ============================================
### 8. UPDATE MATERIAL
### ============================================

### Update material title
PUT {{baseUrl}}/materials/{{materialId}}
Authorization: Bearer {{teacherToken}}
Content-Type: application/json

{
  "title": "Unit 1 - Grammar Rules (Updated)"
}

### Update material description and URL
PUT {{baseUrl}}/materials/{{materialId}}
Authorization: Bearer {{teacherToken}}
Content-Type: application/json

{
  "description": "Updated description with new examples",
  "fileUrl": "https://example.com/files/unit1-grammar-v2.pdf"
}

### Update material type
PUT {{baseUrl}}/materials/{{materialId}}
Authorization: Bearer {{teacherToken}}
Content-Type: application/json

{
  "materialType": "OTHER",
  "description": "Changed to other category"
}

### Update file size
PUT {{baseUrl}}/materials/{{materialId}}
Authorization: Bearer {{teacherToken}}
Content-Type: application/json

{
  "fileSizeKb": 3072
}

### ============================================
### 9. DELETE MATERIAL
### ============================================

### Soft delete material (Teacher)
DELETE {{baseUrl}}/materials/{{materialId}}
Authorization: Bearer {{teacherToken}}

### Permanently delete material (Admin only)
DELETE {{baseUrl}}/materials/{{materialId}}/permanent
Authorization: Bearer {{adminToken}}

### ============================================
### 10. ERROR CASES
### ============================================

### Missing required fields
POST {{baseUrl}}/materials
Authorization: Bearer {{teacherToken}}
Content-Type: application/json

{
  "title": "Test Material"
}

### Invalid material type
POST {{baseUrl}}/materials
Authorization: Bearer {{teacherToken}}
Content-Type: application/json

{
  "groupId": "{{groupId}}",
  "title": "Test Material",
  "materialType": "INVALID_TYPE"
}

### Non-existent group
POST {{baseUrl}}/materials
Authorization: Bearer {{teacherToken}}
Content-Type: application/json

{
  "groupId": "00000000-0000-0000-0000-000000000000",
  "title": "Test Material",
  "materialType": "PDF"
}

### Non-existent material
GET {{baseUrl}}/materials/00000000-0000-0000-0000-000000000000
Authorization: Bearer {{teacherToken}}

### Invalid material type in filter
GET {{baseUrl}}/materials/type/INVALID
Authorization: Bearer {{teacherToken}}

### ============================================
### TESTING NOTES
### ============================================

# Material Types:
# - PDF: PDF documents
# - VIDEO: Video files or links (YouTube, Vimeo, etc.)
# - LINK: External links (websites, online resources)
# - IMAGE: Image files (flashcards, diagrams)
# - OTHER: Other types of materials

# Expected Results:
# - Teachers can create, view, update, and delete materials for their groups
# - Admins can perform all operations on all materials
# - Students and Parents should NOT have access (403 Forbidden)
# - Soft delete sets isActive = false (material still in database)
# - Hard delete permanently removes material (Admin only)
# - Materials belong to specific groups
# - Upload tracking by teacher ID

# Test Workflow:
# 1. Create various types of materials for a group
# 2. Get materials with different filters
# 3. View specific material details
# 4. Get materials by type
# 5. Check group statistics
# 6. Update material information
# 7. Soft delete materials
# 8. Admin permanently deletes materials
# 9. Verify error handling for invalid inputs

# Material Statistics Include:
# - Total materials count
# - Count by material type
# - Total file size in KB
# - Helps track storage usage
