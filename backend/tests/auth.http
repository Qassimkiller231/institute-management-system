@baseUrl = http://localhost:3001
@studentEmail = ahmed.student@example.com
@teacherEmail = sarah.teacher@institute.com
@adminEmail = admin@institute.com
@token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJlMjA1MTBlNi03M2UwLTRiNzYtOWZlOS1mYmNhNjk2NTAxM2UiLCJlbWFpbCI6ImFobWVkLnN0dWRlbnRAZXhhbXBsZS5jb20iLCJyb2xlIjoiU1RVREVOVCIsImlhdCI6MTc2MzMwNDA4MywiZXhwIjoxNzYzOTA4ODgzfQ.KhlQxnkA5McQasxzj9mZ0pZNrBTDf_g0Mprpa8bFvpQ
### ============================================
### HEALTH CHECK
### ============================================

### Health Check - Should return 200 OK
GET {{baseUrl}}/api/health


### ============================================
### REQUEST OTP - SUCCESS CASES
### ============================================

### 1. Request OTP - Student (via email)
POST {{baseUrl}}/api/auth/request-otp
Content-Type: application/json

{
  "identifier": "{{studentEmail}}",
  "method": "email"
}

###

### 2. Request OTP - Student (via phone)
POST {{baseUrl}}/api/auth/request-otp
Content-Type: application/json

{
  "identifier": "33445566",
  "method": "sms"
}

###

### 3. Request OTP - Teacher
POST {{baseUrl}}/api/auth/request-otp
Content-Type: application/json

{
  "identifier": "{{teacherEmail}}",
  "method": "email"
}

###

### 4. Request OTP - Admin
POST {{baseUrl}}/api/auth/request-otp
Content-Type: application/json

{
  "identifier": "{{adminEmail}}",
  "method": "email"
}


### ============================================
### REQUEST OTP - ERROR CASES
### ============================================

### 5. Request OTP - User not found
# Expected: 400 - "User not found"
POST {{baseUrl}}/api/auth/request-otp
Content-Type: application/json

{
  "identifier": "nonexistent@example.com",
  "method": "email"
}

###

### 6. Request OTP - Missing identifier
# Expected: 400 - "Identifier and method are required"
POST {{baseUrl}}/api/auth/request-otp
Content-Type: application/json

{
  "method": "email"
}

###

### 7. Request OTP - Missing method
# Expected: 400 - "Identifier and method are required"
POST {{baseUrl}}/api/auth/request-otp
Content-Type: application/json

{
  "identifier": "{{studentEmail}}"
}

###

### 8. Request OTP - Invalid method
# Expected: 400 - "Method must be either email or sms"
POST {{baseUrl}}/api/auth/request-otp
Content-Type: application/json

{
  "identifier": "{{studentEmail}}",
  "method": "whatsapp"
}

###

### 9. Request OTP - Too soon (rate limiting)
# First request OTP, then immediately request again
# Expected: 400 - "OTP already sent. Please wait..."
POST {{baseUrl}}/api/auth/request-otp
Content-Type: application/json

{
  "identifier": "{{studentEmail}}",
  "method": "email"
}


### ============================================
### VERIFY OTP - SUCCESS CASES
### ============================================

### 10. Verify OTP - Correct code
# ⚠️ UPDATE CODE from terminal after requesting OTP
POST {{baseUrl}}/api/auth/verify-otp
Content-Type: application/json

{
  "identifier": "{{studentEmail}}",
  "code": "634431"
}


### ============================================
### VERIFY OTP - ERROR CASES
### ============================================

### 11. Verify OTP - Wrong code
# Expected: 400 - "Invalid OTP code"
POST {{baseUrl}}/api/auth/verify-otp
Content-Type: application/json

{
  "identifier": "{{studentEmail}}",
  "code": "000000"
}

###

### 12. Verify OTP - Missing identifier
# Expected: 400 - "Identifier and code are required"
POST {{baseUrl}}/api/auth/verify-otp
Content-Type: application/json

{
  "code": "123456"
}

###

### 13. Verify OTP - Missing code
# Expected: 400 - "Identifier and code are required"
POST {{baseUrl}}/api/auth/verify-otp
Content-Type: application/json

{
  "identifier": "{{studentEmail}}"
}

###

### 14. Verify OTP - Invalid code length
# Expected: 400 - "OTP code must be 6 digits"
POST {{baseUrl}}/api/auth/verify-otp
Content-Type: application/json

{
  "identifier": "{{studentEmail}}",
  "code": "123"
}

###

### 15. Verify OTP - User not found
# Expected: 400 - "User not found"
POST {{baseUrl}}/api/auth/verify-otp
Content-Type: application/json

{
  "identifier": "nonexistent@example.com",
  "code": "123456"
}

###

### 16. Verify OTP - Expired code
# Request OTP, wait 6+ minutes, then try to verify
# Expected: 400 - "OTP code has expired"
# (You can't easily test this - would need to modify expiration time)


### ============================================
### PROTECTED ROUTES - SUCCESS CASES
### ============================================

### 17. Get current user - Valid token
# ⚠️ PASTE TOKEN from verify response
GET {{baseUrl}}/api/auth/me
Authorization: Bearer {{token}}

###

### 18. Logout - Valid token
# ⚠️ PASTE TOKEN from verify response
POST {{baseUrl}}/api/auth/logout
Authorization: Bearer {{token}}


### ============================================
### PROTECTED ROUTES - ERROR CASES
### ============================================

### 19. Get current user - No token
# Expected: 401 - "No token provided"
GET {{baseUrl}}/api/auth/me

###

### 20. Get current user - Invalid token
# Expected: 401 - "Invalid or expired token"
GET {{baseUrl}}/api/auth/me
Authorization: Bearer invalid-token-12345

###

### 21. Get current user - Wrong format (missing Bearer)
# Expected: 401 - "No token provided"
GET {{baseUrl}}/api/auth/me
Authorization: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

###

### 22. Logout - No token
# Expected: 401 - "No token provided"
POST {{baseUrl}}/api/auth/logout

###

### 23. Logout - Invalid token
# Expected: 401 - "Invalid or expired token"
POST {{baseUrl}}/api/auth/logout
Authorization: Bearer invalid-token


### ============================================
### COMPLETE FLOW TESTS (Integration)
### ============================================

### 24. Complete Student Login Flow
# Step 1: Request OTP
POST {{baseUrl}}/api/auth/request-otp
Content-Type: application/json

{
  "identifier": "{{studentEmail}}",
  "method": "email"
}

# Step 2: Check terminal for OTP code
# Step 3: Verify OTP (update code below)

###

POST {{baseUrl}}/api/auth/verify-otp
Content-Type: application/json

{
  "identifier": "{{studentEmail}}",
  "code": "544406"
}

# Step 4: Copy token from response
# Step 5: Get user info

###

GET {{baseUrl}}/api/auth/me
Authorization: Bearer {{token}}

# Step 6: Logout

###

POST {{baseUrl}}/api/auth/logout
Authorization: Bearer PASTE_TOKEN_HERE


### ============================================
### ROLE-BASED TESTS
### ============================================

### 25. Login as Teacher
POST {{baseUrl}}/api/auth/request-otp
Content-Type: application/json

{
  "identifier": "{{teacherEmail}}",
  "method": "email"
}

###

POST {{baseUrl}}/api/auth/verify-otp
Content-Type: application/json

{
  "identifier": "{{teacherEmail}}",
  "code": "275750"
}

###

### 26. Login as Admin
POST {{baseUrl}}/api/auth/request-otp
Content-Type: application/json

{
  "identifier": "{{adminEmail}}",
  "method": "email"
}

###

POST {{baseUrl}}/api/auth/verify-otp
Content-Type: application/json

{
  "identifier": "{{adminEmail}}",
  "code": "875085"
}


### ============================================
### EDGE CASES
### ============================================

### 27. Request OTP - Empty strings
POST {{baseUrl}}/api/auth/request-otp
Content-Type: application/json

{
  "identifier": "",
  "method": ""
}

###

### 28. Verify OTP - Special characters in code
POST {{baseUrl}}/api/auth/verify-otp
Content-Type: application/json

{
  "identifier": "{{studentEmail}}",
  "code": "!@#$%^"
}

###

### 29. Case sensitivity test - Email uppercase
POST {{baseUrl}}/api/auth/request-otp
Content-Type: application/json

{
  "identifier": "AHMED.STUDENT@EXAMPLE.COM",
  "method": "email"
}